#!/usr/bin/env bash
# Changes user's shell to default to zsh and downloads modules.
# Assumes zsh is already installed.
# TODO: If universal package manager is used, consider checkikng for install.

set -e

CONF="${CONF:-${HOME}/conf}"
source "${HOME}/.env"

echo "Configuring zsh."

zsh_path="$(which zsh)"
echo "zsh path: ${zsh_path}"
echo "Currenrt shell: $SHELL"

if grep -q "${zsh_path}" /etc/shells; then
  echo "Adding ${zsh_path} to /etc/shells."
  printf "%s" "${zsh_path}" | sudo tee -a /etc/shells
fi

# Change this user's default shell to zsh
if [ "${SHELL}" != "${zsh_path}" ] && [ "${SHELL}" != "/bin/zsh" ]; then
  echo "Changing this user's default shell to zsh."
  user="${USER}"
  sudo chsh -s "${zsh_path}" "${user}"
fi

exit 0

